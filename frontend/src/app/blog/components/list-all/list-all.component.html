<div class="page-wrapper">

  <!-- Header para Admin -->
  <header class="header" *ngIf="isAdminContext">
    <h1>Sementes da Amazônia</h1>
  </header>

  <!-- Navbar para usuários não admin -->
  <app-navbar *ngIf="!isAdminContext"></app-navbar>

  <section class="content" [class.with-navbar]="!isAdminContext" [class.with-sidebar]="isAdminContext">
    <div class="section-header">
      <h2>{{ getPageTitle() }}</h2>
      <p>{{ getPageDescription() }}</p>
    </div>

    <!-- Barra de controles -->
    <div class="controls-bar">
      <!-- Barra de pesquisa -->
      <div class="search-container">
        <div class="search-input-wrapper">
          <mat-icon class="search-icon">search</mat-icon>
          <input type="text" placeholder="Pesquisar por título..." [(ngModel)]="searchTerm"
            (input)="onSearchChange()" class="search-input">
          <button *ngIf="searchTerm" class="clear-button" (click)="clearSearch()" type="button">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>

      <!-- Filtros por tag -->
      <div class="filter-container">
        <span class="filter-label">Filtrar por:</span>
        <div class="filter-buttons">
          <button class="filter-btn news" [class.active]="selectedFilter === 'news'" (click)="onFilterChange('news')">
            Notícias
          </button>
          <button class="filter-btn project" [class.active]="selectedFilter === 'projects'"
            (click)="onFilterChange('projects')">
            Projetos
          </button>
        </div>
      </div>
    </div>

    <ng-container *ngIf="selectedFilter === 'news'">
      <div class="cards-grid">
        <div *ngFor="let item of news" class="card-wrapper">
          <app-news-card [news]="{
            id: item.id,
            title: item.title,
            description: item.summary,
            image: item.image_thumb || '',
            date: item.published_at
          }">
          </app-news-card>

          <!-- Tag de tipo -->
          <div class="type-tag" [ngClass]="'news'">
            Notícia
          </div>

          <!-- Botões de ação (só para admin) -->
          <div class="action-buttons" *ngIf="isAdminContext">
            <p-button icon="pi pi-pencil" [rounded]="true" [text]="true" severity="secondary" (click)="editNews(item)"
              class="edit-btn">
            </p-button>

            <p-button icon="pi pi-trash" [rounded]="true" [text]="true" severity="danger" size="small"
              (click)="deleteItem(item)" class="delete-btn">
            </p-button>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- Projetos -->
    <ng-container *ngIf="selectedFilter === 'projects'">
      <div class="cards-grid">
        <div *ngFor="let item of projects" class="card-wrapper">
          <app-project-card [project]="{
            id: item.id,
            title: item.title,
            description: item.summary,
            image: item.image_thumb || '',
            date: item.created_at
          }">
          </app-project-card>

          <!-- Tag de tipo -->
          <div class="type-tag" [ngClass]="'project'">
            Projeto
          </div>

          <!-- Botões de ação (só para admin) -->
          <div class="action-buttons" *ngIf="isAdminContext">
            <p-button icon="pi pi-pencil" [rounded]="true" [text]="true" severity="secondary"
              (click)="editProject(item)" class="edit-btn">
            </p-button>

            <p-button icon="pi pi-trash" [rounded]="true" [text]="true" severity="danger" size="small"
              (click)="deleteItem(item)" class="delete-btn">
            </p-button>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- Mensagem quando não há resultados -->
    <div class="no-results" *ngIf="totalItems === 0">
      <mat-icon>search_off</mat-icon>
      <h3>Nenhum resultado encontrado</h3>
      <p>Tente ajustar os filtros ou termos de busca.</p>
    </div>

    <!-- Paginação -->
    <div class="pagination-container">
      <mat-paginator [length]="totalItems" [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions"
        [pageIndex]="currentPage" (page)="onPageChange($event)" showFirstLastButtons="true"
        aria-label="Navegação de páginas" class="custom-paginator">
      </mat-paginator>
    </div>
  </section>
</div>

<!-- Modal de confirmação de delete -->
<div class="delete-modal-overlay" *ngIf="showDeleteModal" (click)="cancelDelete()">
  <div class="delete-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <mat-icon class="delete-icon">delete</mat-icon>
    </div>

    <div class="modal-content">
      <h3>Confirmar exclusão</h3>
      <p>
        Tem certeza que deseja deletar esta notícia?
        <!-- <span class="item-type">{{ itemToDelete?.type === 'news' ? 'esta notícia' : 'este projeto' }}</span>? -->
      </p>
      <p class="item-title">"{{ itemToDelete?.title }}"</p>
      <p class="warning-text">Esta ação não pode ser desfeita.</p>
    </div>

    <div class="modal-actions">
      <button class="cancel-btn" (click)="cancelDelete()">
        Cancelar
      </button>
      <button class="confirm-btn" (click)="confirmDelete()">
        <mat-icon>delete</mat-icon>
        Deletar
      </button>
    </div>
  </div>
</div>